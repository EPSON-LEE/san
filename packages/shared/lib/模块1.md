å®ç°ä¸€ä¸ª**è¿è¡Œæ—¶æ¨¡å—åŠ è½½æœºåˆ¶**ï¼ˆRuntime Module Loaderï¼‰æ˜¯ç†è§£ç°ä»£å‰ç«¯æ„å»ºå·¥å…·ï¼ˆå¦‚ Webpackï¼‰ã€å°ç¨‹åºæ¡†æ¶æˆ–æ“ä½œç³»ç»Ÿåº”ç”¨å¹³å°ï¼ˆå¦‚ HarmonyOSï¼‰åº•å±‚åŸç†çš„å…³é”®ã€‚ä¸‹é¢æˆ‘å°†å¸¦ä½ ä»é›¶å¼€å§‹ï¼Œç”¨çº¯ JavaScript å®ç°ä¸€ä¸ª**ç®€åŒ–ä½†åŠŸèƒ½å®Œæ•´**çš„è¿è¡Œæ—¶æ¨¡å—ç³»ç»Ÿã€‚

---

## âœ… ç›®æ ‡åŠŸèƒ½
- æ”¯æŒ `require(moduleId)` åŠ è½½æ¨¡å—
- æ¨¡å—åªæ‰§è¡Œä¸€æ¬¡ï¼ˆç¼“å­˜ï¼‰
- æ”¯æŒ `module.exports` å’Œ `exports`
- æ¨¡å—ä¹‹é—´å¯äº’ç›¸ä¾èµ–
- æ”¯æŒé»˜è®¤å¯¼å‡ºå…¼å®¹ï¼ˆå¯é€‰ï¼‰

---

## ğŸ§± 1. æ ¸å¿ƒæ•°æ®ç»“æ„

```js
// æ¨¡å—å®šä¹‰è¡¨ï¼šmoduleId => å·¥å‚å‡½æ•°
const modules = {};

// æ¨¡å—ç¼“å­˜ï¼šmoduleId => { exports, loaded }
const moduleCache = {};
```

æ¯ä¸ªæ¨¡å—çš„**å·¥å‚å‡½æ•°**ç­¾åï¼š
```js
function factory(module, exports, require) {
  // æ¨¡å—ä»£ç åœ¨è¿™é‡Œæ‰§è¡Œ
  exports.hello = 'world';
  // æˆ–
  module.exports = { hello: 'world' };
}
```

---

## ğŸ” 2. å®ç° `require` å‡½æ•°

```js
function require(moduleId) {
  // 1. æ£€æŸ¥ç¼“å­˜ï¼ˆé¿å…é‡å¤åŠ è½½ï¼‰
  if (moduleCache[moduleId]) {
    return moduleCache[moduleId].exports;
  }

  // 2. è·å–æ¨¡å—å·¥å‚å‡½æ•°
  const factory = modules[moduleId];
  if (!factory) {
    throw new Error(`Module not found: ${moduleId}`);
  }

  // 3. åˆ›å»ºæ¨¡å—å¯¹è±¡
  const module = {
    id: moduleId,
    exports: {},
    loaded: false
  };

  // 4. å°†æ¨¡å—åŠ å…¥ç¼“å­˜ï¼ˆé˜²æ­¢å¾ªç¯ä¾èµ–æ—¶æ— é™é€’å½’ï¼‰
  moduleCache[moduleId] = module;

  // 5. æ‰§è¡Œå·¥å‚å‡½æ•°
  factory(module, module.exports, require);

  // 6. æ ‡è®°ä¸ºå·²åŠ è½½
  module.loaded = true;

  return module.exports;
}
```

> ğŸ’¡ **å…³é”®ç‚¹**ï¼šåœ¨æ‰§è¡Œ `factory` **ä¹‹å‰**å°±å°† `module` æ”¾å…¥ç¼“å­˜ï¼Œå¯æ”¯æŒ**å¾ªç¯ä¾èµ–**ï¼ˆè™½ç„¶ä¸æ¨èï¼Œä½†èƒ½é¿å…å´©æºƒï¼‰ã€‚

---

## ğŸ“¦ 3. æ³¨å†Œæ¨¡å—ï¼ˆæ¨¡æ‹Ÿæ‰“åŒ…è¿‡ç¨‹ï¼‰

åœ¨çœŸå®åœºæ™¯ä¸­ï¼Œæ‰“åŒ…å·¥å…·ï¼ˆå¦‚ Webpackï¼‰ä¼šæŠŠæ‰€æœ‰æ¨¡å—æ”¶é›†åˆ° `modules` å¯¹è±¡ä¸­ã€‚æˆ‘ä»¬æ‰‹åŠ¨æ¨¡æ‹Ÿï¼š

```js
// æ³¨å†Œæ¨¡å—ï¼šmoduleId -> factory
function define(moduleId, factory) {
  modules[moduleId] = factory;
}

// ç¤ºä¾‹ï¼šå®šä¹‰ä¸€ä¸ªå·¥å…·æ¨¡å—
define('utils', (module, exports, require) => {
  exports.add = (a, b) => a + b;
  exports.PI = 3.14;
});

// ç¤ºä¾‹ï¼šå®šä¹‰ä¸€ä¸ªä¾èµ– utils çš„æ¨¡å—
define('math', (module, exports, require) => {
  const utils = require('utils');
  exports.doublePI = () => utils.add(utils.PI, utils.PI);
});
```

---

## â–¶ï¸ 4. ä½¿ç”¨æ¨¡å—

```js
// åŠ è½½å¹¶ä½¿ç”¨æ¨¡å—
const math = require('math');
console.log(math.doublePI()); // 6.28
```

---

## ğŸ§ª å®Œæ•´å¯è¿è¡Œç¤ºä¾‹

```html
<!DOCTYPE html>
<html>
<head>
  <title>Simple Module Loader</title>
</head>
<body>
  <script>
    // ===== è¿è¡Œæ—¶æ¨¡å—ç³»ç»Ÿ =====
    const modules = {};
    const moduleCache = {};

    function require(moduleId) {
      if (moduleCache[moduleId]) {
        return moduleCache[moduleId].exports;
      }

      const factory = modules[moduleId];
      if (!factory) throw new Error(`Module not found: ${moduleId}`);

      const module = { id: moduleId, exports: {}, loaded: false };
      moduleCache[moduleId] = module; // å…ˆç¼“å­˜ï¼Œé˜²å¾ªç¯ä¾èµ–

      factory(module, module.exports, require);
      module.loaded = true;
      return module.exports;
    }

    function define(moduleId, factory) {
      modules[moduleId] = factory;
    }

    // ===== å®šä¹‰æ¨¡å— =====
    define('greet', (module, exports, require) => {
      exports.hello = (name) => `Hello, ${name}!`;
    });

    define('app', (module, exports, require) => {
      const greet = require('greet');
      exports.run = () => console.log(greet.hello('World'));
    });

    // ===== å¯åŠ¨åº”ç”¨ =====
    const app = require('app');
    app.run(); // è¾“å‡º: Hello, World!
  </script>
</body>
</html>
```

---

## ğŸš€ è¿›é˜¶åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰

### 1. **æ”¯æŒ ES Module é£æ ¼é»˜è®¤å¯¼å‡º**
```js
// æ·»åŠ ä¸€ä¸ª interop å‡½æ•°
function interopRequire(moduleId) {
  const m = require(moduleId);
  return m.__esModule ? m.default : m;
}
```

### 2. **å¼‚æ­¥åŠ è½½ï¼ˆç”¨äºåŠ¨æ€ importï¼‰**
```js
async function requireAsync(moduleId) {
  if (!modules[moduleId]) {
    // åŠ¨æ€åŠ è½½è„šæœ¬ï¼ˆä¾‹å¦‚é€šè¿‡ fetch + evalï¼‰
    await loadScript(`/modules/${moduleId}.js`);
  }
  return require(moduleId);
}
```

### 3. **æ¨¡å—çƒ­æ›´æ–°ï¼ˆHMRï¼‰åŸºç¡€**
```js
function hotReload(moduleId, newFactory) {
  modules[moduleId] = newFactory;
  delete moduleCache[moduleId]; // æ¸…é™¤ç¼“å­˜
  // é‡æ–°åŠ è½½ä¾èµ–è¯¥æ¨¡å—çš„å…¶ä»–æ¨¡å—...
}
```

---

## ğŸ†š ä¸çœŸå®å·¥å…·å¯¹æ¯”

| ç‰¹æ€§ | æœ¬å®ç° | Webpack | HarmonyOS |
|------|-------|--------|----------|
| æ¨¡å— ID | å­—ç¬¦ä¸² | æ•°å­—/å­—ç¬¦ä¸² | `@app-module/xxx` |
| åŠ è½½å‡½æ•° | `require` | `__webpack_require__` | `$app_require$` |
| ç¼“å­˜ | `moduleCache` | `__webpack_modules_cache__` | å†…éƒ¨ç¼“å­˜è¡¨ |
| å¾ªç¯ä¾èµ– | æ”¯æŒï¼ˆéƒ¨åˆ†ï¼‰ | æ”¯æŒ | æ”¯æŒ |
| å¼‚æ­¥åŠ è½½ | éœ€æ‰‹åŠ¨æ‰©å±• | å†…ç½® `import()` | æœ‰é™æ”¯æŒ |

---

## ğŸ’¡ åº”ç”¨åœºæ™¯

- **å°ç¨‹åºæ¡†æ¶**ï¼ˆå¦‚å¾®ä¿¡ã€å¿«åº”ç”¨ï¼‰
- **æ“ä½œç³»ç»Ÿåº”ç”¨å¹³å°**ï¼ˆHarmonyOSã€Tizenï¼‰
- **æ’ä»¶ç³»ç»Ÿ**ï¼ˆå¦‚ VS Code æ’ä»¶ï¼‰
- **æ²™ç®±ç¯å¢ƒ**ï¼ˆé™åˆ¶æ¨¡å—è®¿é—®æƒé™ï¼‰
- **æ•™å­¦æ¼”ç¤º**ï¼ˆç†è§£æ¨¡å—ç³»ç»ŸåŸç†ï¼‰

---

## âœ… æ€»ç»“

ä½ åˆšåˆšå®ç°äº†ä¸€ä¸ª**éº»é›€è™½å°äº”è„ä¿±å…¨**çš„è¿è¡Œæ—¶æ¨¡å—åŠ è½½å™¨ï¼ŒåŒ…å«ï¼š

1. **æ¨¡å—æ³¨å†Œ**ï¼ˆ`define`ï¼‰
2. **æ¨¡å—åŠ è½½ä¸ç¼“å­˜**ï¼ˆ`require`ï¼‰
3. **ä¾èµ–è§£æ**
4. **å¾ªç¯ä¾èµ–é˜²æŠ¤**

> è¿™æ­£æ˜¯ Webpackã€HarmonyOS `$app_require$`ã€Node.js `require` ç­‰æœºåˆ¶çš„æ ¸å¿ƒæ€æƒ³ã€‚

ç†è§£å®ƒï¼Œä½ å°±æŒæ¡äº†ç°ä»£å‰ç«¯å·¥ç¨‹åŒ–çš„åº•å±‚åŸºçŸ³ï¼å¦‚æœéœ€è¦æ”¯æŒæ›´å¤šç‰¹æ€§ï¼ˆå¦‚ tree-shakingã€code splittingï¼‰ï¼Œåˆ™éœ€è¦ç»“åˆ**ç¼–è¯‘æ—¶é™æ€åˆ†æ**ï¼Œä½†è¿è¡Œæ—¶åŠ è½½æœºåˆ¶å§‹ç»ˆæ˜¯æ‰§è¡Œé˜¶æ®µçš„å…³é”®ã€‚